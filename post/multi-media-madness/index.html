<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Source Themes Academic 4.8.0"><meta name=description content="The problem So I&rsquo;m a bit of a weeb, and enjoy watching anime from time to time. However I often find myself forgetting my place during the weeks between episodes. This often leads me to drop an anime because I can&rsquo;t find the right episode before losing motivation."><link rel=alternate hreflang=en-us href=/post/multi-media-madness/><meta name=theme-color content="hsl(339, 90%, 68%)"><script src=/js/mathjax-config.js></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css crossorigin=anonymous title=hl-light><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css crossorigin=anonymous title=hl-dark disabled><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin=anonymous async></script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js integrity crossorigin=anonymous async></script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap"><link rel=stylesheet href=/css/academic.css><link rel=manifest href=/index.webmanifest><link rel=icon type=image/png href=/images/icon_hu2c1b947e3c6ab2f9bcd9d848698991ae_70432_32x32_fill_lanczos_center_2.png><link rel=apple-touch-icon type=image/png href=/images/icon_hu2c1b947e3c6ab2f9bcd9d848698991ae_70432_192x192_fill_lanczos_center_2.png><link rel=canonical href=/post/multi-media-madness/><meta property="twitter:card" content="summary"><meta property="og:site_name" content="Faximilie"><meta property="og:url" content="/post/multi-media-madness/"><meta property="og:title" content="Multi-media Madness | Faximilie"><meta property="og:description" content="The problem So I&rsquo;m a bit of a weeb, and enjoy watching anime from time to time. However I often find myself forgetting my place during the weeks between episodes. This often leads me to drop an anime because I can&rsquo;t find the right episode before losing motivation."><meta property="og:image" content="img/map[gravatar:%!s(bool=false) shape:circle]"><meta property="twitter:image" content="img/map[gravatar:%!s(bool=false) shape:circle]"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2020-06-21T14:43:59+10:00"><meta property="article:modified_time" content="2020-06-21T14:43:59+10:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/post/multi-media-madness/"},"headline":"Multi-media Madness","datePublished":"2020-06-21T14:43:59+10:00","dateModified":"2020-06-21T14:43:59+10:00","author":{"@type":"Person","name":"Faximilie"},"publisher":{"@type":"Organization","name":"Faximilie","logo":{"@type":"ImageObject","url":"/images/icon_hu2c1b947e3c6ab2f9bcd9d848698991ae_70432_192x192_fill_lanczos_center_2.png"}},"description":"The problem So I\u0026rsquo;m a bit of a weeb, and enjoy watching anime from time to time. However I often find myself forgetting my place during the weeks between episodes. This often leads me to drop an anime because I can\u0026rsquo;t find the right episode before losing motivation."}</script><title>Multi-media Madness | Faximilie</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=dark><aside class=search-results id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=#><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Faximilie</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Faximilie</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/#posts><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#projects><span>Projects</span></a></li><li class=nav-item><a class=nav-link href=/#featured><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=/#contact><span>Contact</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=#><i class="fas fa-search" aria-hidden=true></i></a></li></ul></div></nav><article class=article><div class="article-container pt-3"><h1>Multi-media Madness</h1><p class=page-subtitle>Watching anime has never been so hard</p><div class=article-metadata><div><span><a href=/author/faximilie/>Faximilie</a></span></div><span class=article-date>Jun 21, 2020</span>
<span class=middot-divider></span><span class=article-reading-time>4 min read</span>
<span class=middot-divider></span><span class=article-categories><i class="fas fa-folder mr-1"></i><a href=/category/automation/>automation</a></span></div></div><div class=article-container><div class=article-style><h2 id=the-problem>The problem</h2><p>So I&rsquo;m a bit of a weeb, and enjoy watching anime from time to time. However I often find myself forgetting my place during the weeks between episodes. This often leads me to drop an anime because I can&rsquo;t find the right episode before losing motivation.</p><p>I also have the issue of friends recommending me an anime, and I will forget it well before I get a chance to watch it.</p><p>Enter Anilist/MyAnimeList, the anime tracking services similar to track.tv. This fixes both problems of tracking watched episodes, and new series to watch. However it introduces new issues, manually updating watched status.</p><p>Now I&rsquo;m a SecDevOps engineer, I won&rsquo;t stand for manual intervention. So let&rsquo;s automate <strong>everything</strong>.</p><h2 id=components>Components</h2><p>As mentioned before Anilist is a key component of my setup, however there are a lot of other moving parts at work here to ensure little to no manual intervention is required.</p><h3 id=kodi>Kodi</h3><p>Kodi is the HTPC interface, allowing me to utilize plex as a media library, while still providing a nice interface and other features independent of plex.</p><p>Being able to start steam big picture, or watch youtube is nice.</p><h4 id=kodi-plex>Kodi Plex</h4><p>This kodi plugin automatically syncs plex and kodi, letting kodi be the nice frontend while plex does all the hard work.</p><p>It ensures watch status, and the library is synced, and will get plex to stream the transcoded videos to kodi.</p><h3 id=plex>Plex</h3><p>Plex provides the backbone of my media library. Transcoding, mobile syncing, and most importantly: the plex anilist sync script.</p><h4 id=plex-anilist-sync>Plex anilist sync</h4><p>This external script will query the Plex API and ensure that Anilist is kept up to date with the watch status.</p><p>The repo can be found here: <a href=https://github.com/RickDB/PlexAniSync>https://github.com/RickDB/PlexAniSync</a></p><h4 id=plex-mpv-shim>plex-mpv-shim</h4><p>This allows me to play videos from Plex locally on my favorite media player, while still syncing, transcoding and such.
It&rsquo;s a very important feature, that allows me to really save battery on the go.</p><p>This project can be found here: <a href=https://github.com/iwalton3/plex-mpv-shim/issues>https://github.com/iwalton3/plex-mpv-shim/issues</a></p><h3 id=sonarr>Sonarr</h3><p>Somehow I need to get the anime, this is the job of sonarr which&mldr; &ldquo;procures&rdquo; the files through totally legal channels.
I won&rsquo;t say anymore on sonarr sadly, despite how amazing it really is.</p><h3 id=flexget>Flexget</h3><p>Flexget is the glue that holds most things together, it provides the mechanism of getting my Anilist watchlist into sonarr to be &ldquo;procured&rdquo; automagically. However there seems to be a bug which caused me to write a fix in the most horrific way.</p><h4 id=flex-fix>Flex fix</h4><p>It seems if a show already exists in sonarr it will return a 500, and give the reason. A sane program would accept this 500 and move on, knowing it was not a severe error.</p><p>However flexget does not do this, it errors out when 500 is returned for <em>any reason</em> which is rather frustrating. It also expects the show details to be returned when it 200s on that same request, so one can not simply have it replace 500 status codes with 200.</p><p>To fix this error, you must intercept all requests, and when a 500 error occurs for an existing show, you must then lookup that existing show through the sonarr api, and return those details to flexget with a 200 http code.</p><p>This python script does exactly that, acting as a proxy, listening on a port below sonarr and connecting to sonarr itself.</p><p>Here it is below, eventually this will be put in gist, but not at the moment.</p><pre><code class=language-python>from http.server import HTTPServer, BaseHTTPRequestHandler
from http.client import HTTPConnection

from io import BytesIO
import json


class SimpleHTTPRequestHandler(BaseHTTPRequestHandler):

    def do_GET(self):
        self.send_response(200)
        api_key = self.headers['X-Api-Key']
        self.end_headers()
        client.request('GET', self.path, headers={'X-Api-Key':api_key})
        self.wfile.write(client.getresponse().read())


    def do_POST(self):
        self.send_response(200)
        self.end_headers()
        content_length = int(self.headers['Content-Length'])
        body = self.rfile.read(content_length)
        # Get API Key
        api_key = self.headers['X-Api-Key']
        body_json = json.loads(body.decode('utf8'))

        # Strip everything but ID
        new_body = {i:body_json[i] for i in body_json if i!='id'}

        # Make a connection to sonarr on behalf of the requester
        client.request('POST', self.path, headers={'X-Api-Key':api_key}, body=json.dumps(new_body))
        resp = client.getresponse()
        # If 400 we're gonna do the fix
        if resp.status == 400:
            resp.read()
            # Get the details of the series from sonarr and send it back to the sender pretending they added it
            client.request('GET', '/api/series/' + str(body_json['id']), headers={'X-Api-Key':api_key})
            self.wfile.write(client.getresponse().read())
        else:
            # If it's another code we simply return what we got
            self.wfile.write(resp.read())


client = HTTPConnection('127.0.0.1:8989')
httpd = HTTPServer(('127.0.0.1', 8988), SimpleHTTPRequestHandler)
httpd.serve_forever()
</code></pre></div><div class=article-tags><a class="badge badge-light" href=/tag/automation/>automation</a>
<a class="badge badge-light" href=/tag/multimedia/>multimedia</a>
<a class="badge badge-light" href=/tag/api/>api</a></div><div class=share-box aria-hidden=true><ul class=share><li><a href="https://twitter.com/intent/tweet?url=/post/multi-media-madness/&text=Multi-media%20Madness" target=_blank rel=noopener class=share-btn-twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=/post/multi-media-madness/&t=Multi-media%20Madness" target=_blank rel=noopener class=share-btn-facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=Multi-media%20Madness&body=/post/multi-media-madness/" target=_blank rel=noopener class=share-btn-email><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=/post/multi-media-madness/&title=Multi-media%20Madness" target=_blank rel=noopener class=share-btn-linkedin><i class="fab fa-linkedin-in"></i></a></li><li><a href="whatsapp://send?text=Multi-media%20Madness%20/post/multi-media-madness/" target=_blank rel=noopener class=share-btn-whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=/post/multi-media-madness/&title=Multi-media%20Madness" target=_blank rel=noopener class=share-btn-weibo><i class="fab fa-weibo"></i></a></li></ul></div><div class="media author-card content-widget-hr"><div class=media-body><h5 class=card-title><a href=/author/faximilie/></a></h5><ul class=network-icon aria-hidden=true></ul></div></div></div></article><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.8/mermaid.min.js integrity="sha256-lyWCDMnMeZiXRi7Zl54sZGKYmgQs4izcT7+tKc+KUBk=" crossorigin=anonymous title=mermaid></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/py.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/sh.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/js.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin=anonymous></script><script>const code_highlighting=true;</script><script>const isSiteThemeDark=true;</script><script>const search_config={"indexURI":"/index.json","minLength":1,"threshold":0.3};const i18n={"no_results":"No results found","placeholder":"Search...","results":"results found"};const content_type={'post':"Posts",'project':"Projects",'publication':"Publications",'talk':"Talks"};</script><script id=search-hit-fuse-template type=text/x-template>
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script><script src=/js/academic.min.c816d323c3a55093dae0829b44ea1ca8.js></script><div class=container><footer class=site-footer><p class=powered-by>Powered by the
<a href=https://sourcethemes.com/academic/ target=_blank rel=noopener>Academic theme</a> for
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a>.
<span class=float-right aria-hidden=true><a href=# class=back-to-top><span class=button_icon><i class="fas fa-chevron-up fa-2x"></i></span></a></span></p></footer></div><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i>Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i>Download</a><div id=modal-error></div></div></div></div></div></body></html>